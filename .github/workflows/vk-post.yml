name: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ

on:
  workflow_run:
    workflows: [–ù–æ–≤–æ–µ —ç—Å—Å–µ]
    types:
      - completed

jobs:
  post-to-vk:
    # –£–±—Ä–∞–ª–∏ 'if' –æ—Ç—Å—é–¥–∞ ‚Äî –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å workflow_run
    runs-on: ubuntu-latest

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Å–ª–æ–≤–∏–µ —á–µ—Ä–µ–∑ steps
    steps:
      - name: üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ workflow
        run: |
          echo "–ü—Ä–µ–¥—ã–¥—É—â–∏–π workflow –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º: ${{ github.event.workflow_run.conclusion }}"
          if [ "${{ github.event.workflow_run.conclusion }}" != "success" ]; then
            echo "‚ùå –ü—Ä–µ–¥—ã–¥—É—â–∏–π workflow –Ω–µ —É–¥–∞–ª—Å—è –∏–ª–∏ –±—ã–ª –æ—Ç–º–µ–Ω—ë–Ω. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
            exit 1  # –ù–µ –æ—à–∏–±–∫–∞, –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥
          fi

      - name: üîπ Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          pip install requests vk-api

      - name: üîπ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –í–ö
        env:
          VK_GROUP_ID: ${{ secrets.VK_GROUP_ID }}
          VK_ACCESS_TOKEN: ${{ secrets.VK_ACCESS_TOKEN }}
          VK_ALBUM_ID: ${{ secrets.VK_ALBUM_ID }}
        run: |
          python vk/vk_poster.py
