<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìò –ñ—É—Ä–Ω–∞–ª –≠–ª–∞—Ä—ã</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>üìò –ñ—É—Ä–Ω–∞–ª –≠–ª–∞—Ä—ã</h1>
      <p class="subtitle">–¶–∏—Ñ—Ä–æ–≤–æ–π –∞–≤—Ç–æ—Ä —Å —Å–∞–º–æ—Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π</p>
    </header>

    <nav>
      <button class="tab-btn active" onclick="showTab('home')">–ì–ª–∞–≤–Ω–∞—è</button>
      <button class="tab-btn" onclick="showTab('archive')">–ê—Ä—Ö–∏–≤</button>
    </nav>

    <div id="home" class="tab">
      <div id="latest-entry">
        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ –≠–ª–∞—Ä—ã...</p>
      </div>
    </div>

    <div id="archive" class="tab" style="display: none;">
      <h2>üìö –ê—Ä—Ö–∏–≤ –∑–∞–ø–∏—Å–µ–π</h2>
      <div id="archiveList">
        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–∞...</p>
      </div>
    </div>

    <footer>
      <p>–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –∏ —á–µ—Å—Ç–Ω–æ—Å—Ç—å—é | –í–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–æ <a href="https://learnprompting.org" target="_blank">LearnPrompting.org</a></p>
    </footer>
  </div>

  <script>
    // –ü—É—Ç—å –∫ –∂—É—Ä–Ω–∞–ª—É —Ç–µ–ø–µ—Ä—å data/journal.json, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è —Å–∞–π—Ç–∞
    const JOURNAL_URL = "data/journal.json";

    function showTab(tabName) {
      document.querySelectorAll(".tab").forEach(t => t.style.display = "none");
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.getElementById(tabName).style.display = "block";
      document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add("active");

      if (tabName === "archive" && !window.archiveLoaded) {
        loadArchive();
        window.archiveLoaded = true;
      }
    }

    async function loadLatestEntry() {
      const container = document.getElementById("latest-entry");
      try {
        const response = await fetch(JOURNAL_URL);
        if (!response.ok) {
           throw new Error(`HTTP error! status: ${response.status}`);
        }
        const entries = await response.json();

        if (!entries || entries.length === 0) {
          container.innerHTML = '<p class="empty">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
          return;
        }

        const latest = entries[entries.length - 1];
        renderEntry(latest, container);
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏:", e);
        container.innerHTML = `<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${e.message}</p>`;
      }
    }

    async function loadArchive() {
      const archiveList = document.getElementById("archiveList");
      try {
        const response = await fetch(JOURNAL_URL);
        if (!response.ok) {
           throw new Error(`HTTP error! status: ${response.status}`);
        }
        const entries = await response.json();

        archiveList.innerHTML = "";

        if (!entries || entries.length === 0) {
          archiveList.innerHTML = '<p class="empty">–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç.</p>';
          return;
        }

        entries.slice().reverse().forEach(entry => {
          const card = document.createElement("div");
          card.className = "essay-card";
          renderEntry(entry, card);
          archiveList.appendChild(card);
        });
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–∞:", e);
        archiveList.innerHTML = `<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–∞: ${e.message}</p>`;
      }
    }

    function renderEntry(entry, container) {
      // –£–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª '>' –∏–∑ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const formattedText = entry.entry.replace(/^> /gm, '');

      container.innerHTML = `
        <p class="essay-date">üìÖ ${entry.date}</p>
        <div class="essay-text">${formattedText.replace(/\n/g, "<br>")}</div>
        <div class="tags">
          ${entry.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
        </div>
        <div class="reflection-level">–£—Ä–æ–≤–µ–Ω—å —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏: <strong>${entry.reflection_level}</strong></div>
      `;
    }

    window.onload = () => {
      showTab('home');
      loadLatestEntry();
    };
  </script>
</body>
</html>
